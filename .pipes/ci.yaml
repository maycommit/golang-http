name: ci

tasks:
  static-analisys:
    remoteTask: "https://raw.githubusercontent.com/maycommit/tasks/master/golang-default-quality/task.yaml"

  build-and-push:
    runAfter: ["static-analisys"]
    remoteTask: "https://raw.githubusercontent.com/maycommit/tasks/master/build-and-push/task.yaml"
    inputs:
      - name: name
        value: {{ .Name }}
      - name: revision
        value: {{ .Branch }}

  deploy-helm:
    runAfter: ["build-and-push"]
    inputs:
      - name: image
        value: $(tasks.build-and-push.results.current-image)
    steps:
      - image: "jeias/helm-goldenimg:2.0.6"
        env:
          - name: HELM_APP
            value: {{ .Name }}
          - name: APP_VERSION
            value: $(params.image)
